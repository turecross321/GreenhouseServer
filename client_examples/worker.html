<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebSocket Chat</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
      }

      #chat {
        width: 100%;
        height: 250px;
        border: 1px solid #ccc;
        padding: 10px;
        overflow-y: auto;
        margin-top: 10px;
        background: #f8f8f8;
      }

      #message {
        width: 80%;
        padding: 8px;
      }

      #send {
        padding: 8px 12px;
      }
    </style>
  </head>

  <body>
    <h1>WORKER</h1>

    <button id="connectBtn">Connect</button>

    <div id="chat"></div>

    <div style="margin-top: 10px">
      <input type="text" id="message" placeholder="Type message..." />
      <button id="send">Send</button>
    </div>

    <script>
      const wsUri = "ws://127.0.0.1:8080?type=worker";
      let websocket = null;

      const chatBox = document.getElementById("chat");
      const connectBtn = document.getElementById("connectBtn");
      const sendBtn = document.getElementById("send");
      const messageInput = document.getElementById("message");

      // Add a message to the chat box
      function addMessage(text, isIncoming = false) {
        const msg = document.createElement("div");
        msg.textContent = (isIncoming ? "Server: " : "You: ") + text;
        msg.style.color = isIncoming ? "blue" : "green";
        chatBox.appendChild(msg);
        chatBox.scrollTop = chatBox.scrollHeight;
      }

      // CONNECT BUTTON
      connectBtn.onclick = () => {
        if (websocket && websocket.readyState === WebSocket.OPEN) {
          addMessage("Already connected.");
          return;
        }

        websocket = new WebSocket(wsUri);

        websocket.onopen = () => addMessage("Connected to server!");
        websocket.onmessage = (event) => addMessage(event.data, true);
        websocket.onerror = () => addMessage("Error connecting to server.");
        websocket.onclose = () => addMessage("Connection closed.");
      };

      // SEND BUTTON
      sendBtn.onclick = () => {
        const text = messageInput.value.trim();
        if (!text) return;

        if (!websocket || websocket.readyState !== WebSocket.OPEN) {
          addMessage("Not connected to server.");
          return;
        }

        websocket.send(text);
        addMessage(text);
        messageInput.value = "";
      };

      // ENTER KEY to send
      messageInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter") sendBtn.click();
      });
    </script>
  </body>
</html>
